"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[4101],{2789:(i,s)=>{s.A=(i,s)=>{const e=i.__vccOpts||i;for(const[i,a]of s)e[i]=a;return e}},6439:(i,s,e)=>{e.r(s),e.d(s,{comp:()=>l,data:()=>d});var a=e(7829);const n=[(0,a.Fv)('<h1 id="redis-最大打开文件数" tabindex="-1"><a class="header-anchor" href="#redis-最大打开文件数"><span>Redis 最大打开文件数</span></a></h1><p>在运行高并发Redis服务时,我们可能会遇到&quot;max number of clients reached&quot;的错误。这通常是因为系统对可打开文件数的限制太低导致的。本文将指导您如何提高Redis服务器的最大打开文件数(Max open files)限制。</p><h2 id="问题诊断" tabindex="-1"><a class="header-anchor" href="#问题诊断"><span>问题诊断</span></a></h2><p>首先,让我们查看当前的系统限制和Redis进程的限制:</p><ol><li>检查系统级别的限制:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/security/limits.conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;nofile\\|nproc&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>输出可能类似于:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>* soft nofile 65536</span></span>\n<span class="line"><span>* hard nofile 65536</span></span>\n<span class="line"><span>* soft nproc 65565</span></span>\n<span class="line"><span>* hard nproc 65565</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>检查Redis进程的实际限制:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pidof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redis-server</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /proc/</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">pi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/limits</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中<code>&lt;pid&gt;</code>是Redis服务器的进程ID。输出可能显示:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Max open files            10240                10240                files</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果这个值明显小于系统限制,那么我们需要进行一些调整。</p><h2 id="解决步骤" tabindex="-1"><a class="header-anchor" href="#解决步骤"><span>解决步骤</span></a></h2><h3 id="_1-修改系统级别的限制" tabindex="-1"><a class="header-anchor" href="#_1-修改系统级别的限制"><span>1. 修改系统级别的限制</span></a></h3><p>如果系统级别的限制不够高,首先在<code>/etc/security/limits.conf</code>文件中设置更高的限制:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>* soft nofile 65536</span></span>\n<span class="line"><span>* hard nofile 65536</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-为redis进程特别设置限制" tabindex="-1"><a class="header-anchor" href="#_2-为redis进程特别设置限制"><span>2. 为Redis进程特别设置限制</span></a></h3><p>假设Redis由用户&quot;redis&quot;运行,在<code>/etc/security/limits.conf</code>文件中添加:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>redis soft nofile 65536</span></span>\n<span class="line"><span>redis hard nofile 65536</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果Redis以root用户运行,则改为:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>root soft nofile 65536</span></span>\n<span class="line"><span>root hard nofile 65536</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-修改redis配置文件" tabindex="-1"><a class="header-anchor" href="#_3-修改redis配置文件"><span>3. 修改Redis配置文件</span></a></h3><p>在Redis的配置文件(通常是<code>/etc/redis/redis.conf</code>或<code>/etc/redis.conf</code>)中,添加或修改:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>maxclients 65000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_4-修改systemd服务文件" tabindex="-1"><a class="header-anchor" href="#_4-修改systemd服务文件"><span>4. 修改systemd服务文件</span></a></h3><p>如果Redis是通过systemd管理的,编辑<code>/etc/systemd/system/redis.service</code>文件(如果不存在,可能在<code>/lib/systemd/system/redis.service</code>),添加:</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[Service]</span></span>\n<span class="line"><span>LimitNOFILE=65536</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-重新加载systemd并重启redis" tabindex="-1"><a class="header-anchor" href="#_5-重新加载systemd并重启redis"><span>5. 重新加载systemd并重启Redis</span></a></h3><p>执行以下命令:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> daemon-reload</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-验证更改" tabindex="-1"><a class="header-anchor" href="#_6-验证更改"><span>6. 验证更改</span></a></h3><p>重启Redis后,再次检查限制:</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pidof</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> redis-server</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /proc/</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">pi</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/limits</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h2><ul><li>如果上述步骤执行后仍然没有效果,可能需要检查SELinux或其他安全机制是否在限制Redis的文件描述符使用。</li><li>某些云平台或容器环境可能有额外的限制机制,需要单独配置。</li><li>确保设置的限制值不会对系统整体性能造成负面影响。</li></ul><p>通过以上步骤,您应该能够成功提高Redis服务器的最大打开文件数限制,从而支持更多的并发连接。</p>',37)],t={},l=(0,e(2789).A)(t,[["render",function(i,s){return(0,a.uX)(),(0,a.CE)("div",null,n)}]]),d=JSON.parse('{"path":"/posts/2024-10-10-blog_redis.html","title":"Redis 最大打开文件数","lang":"zh-CN","frontmatter":{"title":"Redis 最大打开文件数","category":["Redis"],"tag":["Redis","Max open files"],"sticky":false,"star":false,"order":-0.01,"description":"Redis 最大打开文件数 在运行高并发Redis服务时,我们可能会遇到\\"max number of clients reached\\"的错误。这通常是因为系统对可打开文件数的限制太低导致的。本文将指导您如何提高Redis服务器的最大打开文件数(Max open files)限制。 问题诊断 首先,让我们查看当前的系统限制和Redis进程的限制: 检查系...","head":[["meta",{"property":"og:url","content":"https://newzone.top/posts/2024-10-10-blog_redis.html"}],["meta",{"property":"og:site_name","content":"LearnData 开源笔记"}],["meta",{"property":"og:title","content":"Redis 最大打开文件数"}],["meta",{"property":"og:description","content":"Redis 最大打开文件数 在运行高并发Redis服务时,我们可能会遇到\\"max number of clients reached\\"的错误。这通常是因为系统对可打开文件数的限制太低导致的。本文将指导您如何提高Redis服务器的最大打开文件数(Max open files)限制。 问题诊断 首先,让我们查看当前的系统限制和Redis进程的限制: 检查系..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-31T06:53:49.000Z"}],["meta",{"property":"article:author","content":"LearnData"}],["meta",{"property":"article:tag","content":"Redis"}],["meta",{"property":"article:tag","content":"Max open files"}],["meta",{"property":"article:modified_time","content":"2025-10-31T06:53:49.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis 最大打开文件数\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-31T06:53:49.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LearnData\\",\\"url\\":\\"https://newzone.top\\"}]}"]]},"headers":[{"level":2,"title":"问题诊断","slug":"问题诊断","link":"#问题诊断","children":[]},{"level":2,"title":"解决步骤","slug":"解决步骤","link":"#解决步骤","children":[{"level":3,"title":"1. 修改系统级别的限制","slug":"_1-修改系统级别的限制","link":"#_1-修改系统级别的限制","children":[]},{"level":3,"title":"2. 为Redis进程特别设置限制","slug":"_2-为redis进程特别设置限制","link":"#_2-为redis进程特别设置限制","children":[]},{"level":3,"title":"3. 修改Redis配置文件","slug":"_3-修改redis配置文件","link":"#_3-修改redis配置文件","children":[]},{"level":3,"title":"4. 修改systemd服务文件","slug":"_4-修改systemd服务文件","link":"#_4-修改systemd服务文件","children":[]},{"level":3,"title":"5. 重新加载systemd并重启Redis","slug":"_5-重新加载systemd并重启redis","link":"#_5-重新加载systemd并重启redis","children":[]},{"level":3,"title":"6. 验证更改","slug":"_6-验证更改","link":"#_6-验证更改","children":[]}]},{"level":2,"title":"注意事项","slug":"注意事项","link":"#注意事项","children":[]}],"git":{"createdTime":1728528616000,"updatedTime":1761893629000,"contributors":[{"name":"lengxc","email":"lengxc@qiysd.com","commits":1},{"name":"weixin_40055370","email":"weixin_40055370@noreply.gitcode.com","commits":1}]},"readingTime":{"minutes":2.39,"words":717},"filePathRelative":"_posts/2024-10-10-blog_redis.md","localizedDate":"2024年10月10日","excerpt":"\\n<p>在运行高并发Redis服务时,我们可能会遇到\\"max number of clients reached\\"的错误。这通常是因为系统对可打开文件数的限制太低导致的。本文将指导您如何提高Redis服务器的最大打开文件数(Max open files)限制。</p>\\n<h2>问题诊断</h2>\\n<p>首先,让我们查看当前的系统限制和Redis进程的限制:</p>\\n<ol>\\n<li>检查系统级别的限制:</li>\\n</ol>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" data-title=\\"bash\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\">cat</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> /etc/security/limits.conf</span><span style=\\"--shiki-light:#D73A49;--shiki-dark:#ABB2BF\\"> |</span><span style=\\"--shiki-light:#6F42C1;--shiki-dark:#61AFEF\\"> grep</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\"> \'nofile\\\\|nproc\'</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);