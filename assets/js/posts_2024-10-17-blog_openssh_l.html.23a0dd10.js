"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[3592],{242:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>e,data:()=>h});var n=a(1696);const l={},e=(0,a(4328).A)(l,[["render",function(s,i){return(0,n.uX)(),(0,n.CE)("div",null,[...i[0]||(i[0]=[(0,n.Fv)('<h1 id="ccentos7-openssh和openssl升级" tabindex="-1"><a class="header-anchor" href="#ccentos7-openssh和openssl升级"><span>CCentOS7 OpenSSH和OpenSSL升级</span></a></h1><p>在处理服务器安全问题时，及时升级关键组件的版本是非常重要的。本文将详细介绍如何在CentOS 7系统上升级OpenSSH和OpenSSL到最新稳定版本，以解决已知的安全漏洞。</p><h2 id="环境说明" tabindex="-1"><a class="header-anchor" href="#环境说明"><span>环境说明</span></a></h2><h3 id="当前系统版本" tabindex="-1"><a class="header-anchor" href="#当前系统版本"><span>当前系统版本</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@tamkems-yy ~]# cat /etc/redhat-release </span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">CentOS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Linux</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> release</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 7.8.2003</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (Core)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="当前组件版本" tabindex="-1"><a class="header-anchor" href="#当前组件版本"><span>当前组件版本</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@tamkems-yy ~]# ssh -V</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">OpenSSH_7.4p1,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> OpenSSL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1.0.2k-fips</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2017</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[root@tamkems-yy ~]# openssl version</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">OpenSSL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1.0.2k-fips</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">  26</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Jan</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2017</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="现存安全漏洞" tabindex="-1"><a class="header-anchor" href="#现存安全漏洞"><span>现存安全漏洞</span></a></h2><p>当前版本存在以下安全漏洞：</p><ul><li>OpenSSH 安全漏洞(CVE-2023-51767)</li><li>OpenSSH 安全漏洞(CVE-2023-38408)</li><li>OpenSSH 命令注入漏洞(CVE-2020-15778)</li><li>OpenSSH 欺骗安全漏洞(CVE-2019-6110)</li><li>OpenSSH信息泄露漏洞(CVE-2020-14145)</li><li>OpenSSH 用户枚举漏洞(CVE-2018-15919)</li><li>OpenSSH 安全漏洞(CVE-2023-48795)</li><li>OpenSSH CBC模式信息泄露漏洞(CVE-2008-5161)</li><li>等多个安全漏洞...</li></ul><h2 id="升级目标版本" tabindex="-1"><a class="header-anchor" href="#升级目标版本"><span>升级目标版本</span></a></h2><ul><li>OpenSSH: 9.6p1</li><li>OpenSSL: 1.1.1w</li></ul><h2 id="升级准备工作" tabindex="-1"><a class="header-anchor" href="#升级准备工作"><span>升级准备工作</span></a></h2><p>在开始升级之前，需要做好以下准备：</p><ol><li>系统备份</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建备份目录</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/ssh_backup_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +%Y%m%d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 备份当前配置</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/ssh/</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/ssh_backup_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +%Y%m%d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/sysconfig/sshd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /root/ssh_backup_</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">$(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">date</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> +%Y%m%d</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>安装必要的编译工具</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装开发工具组</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> groupinstall</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Development Tools&quot;</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装依赖包</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zlib-devel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssl-devel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> perl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> perl-devel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pam-devel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="openssl升级步骤" tabindex="-1"><a class="header-anchor" href="#openssl升级步骤"><span>OpenSSL升级步骤</span></a></h2><h3 id="_1-下载和解压" tabindex="-1"><a class="header-anchor" href="#_1-下载和解压"><span>1. 下载和解压</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/src</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://www.openssl.org/source/openssl-1.1.1w.tar.gz</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -zxf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssl-1.1.1w.tar.gz</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssl-1.1.1w</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-编译安装" tabindex="-1"><a class="header-anchor" href="#_2-编译安装"><span>2. 编译安装</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./config</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --prefix=/usr/local/openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> shared</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zlib</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编译和测试</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> test</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 安装</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-配置环境" tabindex="-1"><a class="header-anchor" href="#_3-配置环境"><span>3. 配置环境</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置动态链接库</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">echo</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/usr/local/openssl/lib&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/ld.so.conf.d/openssl.conf</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ldconfig</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 替换原有的OpenSSL</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/openssl.old</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ln</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/openssl/bin/openssl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/bin/openssl</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="openssh升级步骤" tabindex="-1"><a class="header-anchor" href="#openssh升级步骤"><span>OpenSSH升级步骤</span></a></h2><h3 id="_1-下载和解压-1" tabindex="-1"><a class="header-anchor" href="#_1-下载和解压-1"><span>1. 下载和解压</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/src</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://cdn.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-9.6p1.tar.gz</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -zxf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssh-9.6p1.tar.gz</span></span>\n<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> openssh-9.6p1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-编译安装-1" tabindex="-1"><a class="header-anchor" href="#_2-编译安装-1"><span>2. 编译安装</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 配置</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">./configure</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --prefix=/usr</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --sysconfdir=/etc/ssh</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --with-ssl-dir=/usr/local/openssl</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --with-zlib</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --with-pam</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --with-md5-passwords</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">    --with-tcp-wrappers</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 编译和安装</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-创建systemd服务配置" tabindex="-1"><a class="header-anchor" href="#_3-创建systemd服务配置"><span>3. 创建systemd服务配置</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建 systemd 服务文件</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/usr/lib/systemd/system/sshd.service</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&#39;EOF&#39;</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[Unit]</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Description=OpenSSH server daemon</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Documentation=man:sshd(8) man:sshd_config(5)</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">After=network.target</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[Service]</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Type=exec</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ExecStart=/usr/sbin/sshd -D -e</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ExecReload=/bin/kill -HUP $MAINPID</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">KillMode=process</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Restart=on-failure</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">RestartSec=3s</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">[Install]</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">WantedBy=multi-user.target</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-更新ssh配置文件" tabindex="-1"><a class="header-anchor" href="#_4-更新ssh配置文件"><span>4. 更新SSH配置文件</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 创建新的 sshd_config 配置文件</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &gt; </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/etc/ssh/sshd_config</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;&lt; </span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&#39;EOF&#39;</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 基本配置</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Port 22</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AddressFamily any</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ListenAddress 0.0.0.0</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ListenAddress ::</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 协议版本</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Protocol 2</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 主机密钥</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">HostKey /etc/ssh/ssh_host_rsa_key</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">HostKey /etc/ssh/ssh_host_ecdsa_key</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">HostKey /etc/ssh/ssh_host_ed25519_key</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 日志级别</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">SyslogFacility AUTHPRIV</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">LogLevel INFO</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 认证配置</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PermitRootLogin yes</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PubkeyAuthentication yes</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">AuthorizedKeysFile .ssh/authorized_keys</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PasswordAuthentication yes</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PermitEmptyPasswords no</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">ChallengeResponseAuthentication no</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"># 其他设置</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">X11Forwarding yes</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">PrintMotd no</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">UsePAM yes</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">UseDNS no</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Subsystem sftp /usr/libexec/openssh/sftp-server</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_5-设置正确的文件权限" tabindex="-1"><a class="header-anchor" href="#_5-设置正确的文件权限"><span>5. 设置正确的文件权限</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置关键文件权限</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 755</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/sbin/sshd</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 755</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/ssh</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 644</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/ssh/sshd_config</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 600</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/ssh/ssh_host_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">_key</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chmod</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 644</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /etc/ssh/ssh_host_</span><span style="--shiki-light:#E45649;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">_key.pub</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-重启服务" tabindex="-1"><a class="header-anchor" href="#_6-重启服务"><span>6. 重启服务</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重新加载 systemd 配置</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> daemon-reload</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 重启 sshd 服务</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sshd</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 检查服务状态</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> status</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sshd</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-验证升级" tabindex="-1"><a class="header-anchor" href="#_7-验证升级"><span>7. 验证升级</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 检查 SSH 版本</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -V</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 尝试本地连接测试</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ssh</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -v</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> localhost</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="故障排查指南" tabindex="-1"><a class="header-anchor" href="#故障排查指南"><span>故障排查指南</span></a></h2><p>如果升级后遇到问题，可以按以下步骤排查：</p><ol><li>检查日志文件</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/log/secure</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /var/log/messages</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>检查防火墙设置</li></ol><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">firewall-cmd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --list-services</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ssh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="3"><li>如需回滚，执行以下操作： <ul><li>停止sshd服务</li><li>从备份目录恢复配置文件</li><li>重启服务</li></ul></li></ol><h2 id="安全建议" tabindex="-1"><a class="header-anchor" href="#安全建议"><span>安全建议</span></a></h2><p>完成升级后，建议采取以下安全措施：</p><ol><li><p>加强SSH配置</p><ul><li>禁用不安全的加密算法</li><li>限制root用户登录</li><li>设置登录失败次数限制</li><li>配置密钥认证</li></ul></li><li><p>定期维护</p><ul><li>检查系统日志</li><li>监控失败的登录尝试</li><li>定期检查服务状态</li></ul></li></ol><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>通过以上步骤，我们已经成功将OpenSSH和OpenSSL升级到了最新的稳定版本，解决了多个安全漏洞。建议在执行升级操作前，先在测试环境中进行验证，确保升级过程不会影响到生产环境的正常运行。</p><h2 id="参考文档" tabindex="-1"><a class="header-anchor" href="#参考文档"><span>参考文档</span></a></h2><ul><li>OpenSSH官方文档: https://www.openssh.com/</li><li>OpenSSL官方文档: https://www.openssl.org/</li><li>CentOS 7官方文档: https://wiki.centos.org/</li></ul>',54)])])}]]),h=JSON.parse('{"path":"/posts/2024-10-17-blog_openssh_l.html","title":"CentOS7 OpenSSH和OpenSSL升级","lang":"zh-CN","frontmatter":{"title":"CentOS7 OpenSSH和OpenSSL升级","category":["CentOS","安全"],"tag":["OpenSSH","OpenSSL"],"sticky":false,"star":false,"order":-0.01,"description":"CCentOS7 OpenSSH和OpenSSL升级 在处理服务器安全问题时，及时升级关键组件的版本是非常重要的。本文将详细介绍如何在CentOS 7系统上升级OpenSSH和OpenSSL到最新稳定版本，以解决已知的安全漏洞。 环境说明 当前系统版本 当前组件版本 现存安全漏洞 当前版本存在以下安全漏洞： OpenSSH 安全漏洞(CVE-2023-...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CentOS7 OpenSSH和OpenSSL升级\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-11-30T04:12:19.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LearnData\\",\\"url\\":\\"https://note.luoqiu.site\\"}]}"],["meta",{"property":"og:url","content":"https://note.luoqiu.site/posts/2024-10-17-blog_openssh_l.html"}],["meta",{"property":"og:site_name","content":"LearnData 开源笔记"}],["meta",{"property":"og:title","content":"CentOS7 OpenSSH和OpenSSL升级"}],["meta",{"property":"og:description","content":"CCentOS7 OpenSSH和OpenSSL升级 在处理服务器安全问题时，及时升级关键组件的版本是非常重要的。本文将详细介绍如何在CentOS 7系统上升级OpenSSH和OpenSSL到最新稳定版本，以解决已知的安全漏洞。 环境说明 当前系统版本 当前组件版本 现存安全漏洞 当前版本存在以下安全漏洞： OpenSSH 安全漏洞(CVE-2023-..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-11-30T04:12:19.000Z"}],["meta",{"property":"article:tag","content":"OpenSSL"}],["meta",{"property":"article:tag","content":"OpenSSH"}],["meta",{"property":"article:modified_time","content":"2025-11-30T04:12:19.000Z"}]]},"git":{"createdTime":1764475939000,"updatedTime":1764475939000,"contributors":[{"name":"lengxc","username":"lengxc","email":"lengxc@qiysd.com","commits":1,"url":"https://github.com/lengxc"}]},"readingTime":{"minutes":3.81,"words":1142},"filePathRelative":"_posts/2024-10-17-blog_openssh_l.md","excerpt":"\\n<p>在处理服务器安全问题时，及时升级关键组件的版本是非常重要的。本文将详细介绍如何在CentOS 7系统上升级OpenSSH和OpenSSL到最新稳定版本，以解决已知的安全漏洞。</p>\\n<h2>环境说明</h2>\\n<h3>当前系统版本</h3>\\n<div class=\\"language-bash line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"bash\\" style=\\"--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-light one-dark-pro vp-code\\"><code class=\\"language-bash\\"><span class=\\"line\\"><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\">[root@tamkems-yy ~]# cat /etc/redhat-release </span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#4078F2;--shiki-dark:#61AFEF\\">CentOS</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> Linux</span><span style=\\"--shiki-light:#50A14F;--shiki-dark:#98C379\\"> release</span><span style=\\"--shiki-light:#986801;--shiki-dark:#D19A66\\"> 7.8.2003</span><span style=\\"--shiki-light:#383A42;--shiki-dark:#ABB2BF\\"> (Core)</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')},4328:(s,i)=>{i.A=(s,i)=>{const a=s.__vccOpts||s;for(const[s,n]of i)a[s]=n;return a}}}]);