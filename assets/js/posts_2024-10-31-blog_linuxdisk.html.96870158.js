"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[6090],{2789:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}},9001:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>t,data:()=>h});var n=a(7829);const e=[(0,n.Fv)('<h1 id="linux-lvm磁盘在线扩容教程" tabindex="-1"><a class="header-anchor" href="#linux-lvm磁盘在线扩容教程"><span>Linux LVM磁盘在线扩容教程</span></a></h1><h2 id="问题背景" tabindex="-1"><a class="header-anchor" href="#问题背景"><span>问题背景</span></a></h2><p>在虚拟机环境下，需要将一个2TB的磁盘扩容到2.5TB。初始磁盘使用MBR分区表，由于MBR不支持2TB以上的分区，需要特殊处理。</p><h2 id="系统环境" tabindex="-1"><a class="header-anchor" href="#系统环境"><span>系统环境</span></a></h2><ul><li>操作系统：Linux</li><li>原始磁盘：2TB (/dev/vdb)</li><li>目标容量：2.5TB</li><li>文件系统：XFS</li><li>分区方式：从MBR转换到GPT</li></ul><h2 id="问题分析" tabindex="-1"><a class="header-anchor" href="#问题分析"><span>问题分析</span></a></h2><ol><li>MBR分区表限制：最大支持2TB空间</li><li>需要保留原有LVM数据</li><li>新增空间需要创建新分区并加入现有卷组</li></ol><h2 id="解决步骤" tabindex="-1"><a class="header-anchor" href="#解决步骤"><span>解决步骤</span></a></h2><h3 id="_1-使用parted工具进行分区" tabindex="-1"><a class="header-anchor" href="#_1-使用parted工具进行分区"><span>1. 使用parted工具进行分区</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 进入parted交互模式</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parted</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vdb</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 设置单位为GB</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">unit</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GB</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 创建新分区</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parted</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mkpart</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-格式化新分区并加入lvm" tabindex="-1"><a class="header-anchor" href="#_2-格式化新分区并加入lvm"><span>2. 格式化新分区并加入LVM</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 格式化新分区为XFS文件系统</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mkfs.xfs</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vdb2</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 创建物理卷</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pvcreate</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vdb2</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 扩展卷组</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vgextend</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vg_name</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vdb2</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 扩展逻辑卷</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lvextend</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -l</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> +100%FREE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vg_name/lv_name</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 扩展XFS文件系统</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">xfs_growfs</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vg_name/lv_name</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="lvm清理步骤" tabindex="-1"><a class="header-anchor" href="#lvm清理步骤"><span>LVM清理步骤</span></a></h2><h3 id="_1-清理逻辑卷-lv" tabindex="-1"><a class="header-anchor" href="#_1-清理逻辑卷-lv"><span>1. 清理逻辑卷（LV）</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 卸载文件系统</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">umount</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vg_name/lv_name</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 删除逻辑卷</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lvremove</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vg_name/lv_name</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 确认逻辑卷已删除</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lvdisplay</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-清理卷组-vg" tabindex="-1"><a class="header-anchor" href="#_2-清理卷组-vg"><span>2. 清理卷组（VG）</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 删除卷组</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vgremove</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vg_name</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 确认卷组已删除</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vgdisplay</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-清理物理卷-pv" tabindex="-1"><a class="header-anchor" href="#_3-清理物理卷-pv"><span>3. 清理物理卷（PV）</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 删除物理卷</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pvremove</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vdb1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vdb2</span></span>\n<span class="line"></span>\n<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 确认物理卷已删除</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pvdisplay</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h3><ol><li>清理前确保相关文件系统已经卸载</li><li>清理顺序必须是：LV → VG → PV</li><li>删除操作不可恢复，请提前备份重要数据</li><li>使用display命令确认每一步的清理结果</li></ol><h2 id="注意事项-1" tabindex="-1"><a class="header-anchor" href="#注意事项-1"><span>注意事项</span></a></h2><ol><li>在进行磁盘操作前，建议先备份重要数据</li><li>MBR转GPT需要谨慎操作，确保数据安全</li><li>分区工具的选择：大于2TB建议使用parted而不是fdisk</li><li>XFS文件系统支持在线扩容，无需卸载</li></ol><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h2><p>通过合理利用GPT分区表和LVM的特性，我们成功实现了在线扩容。这个方案既保留了原有数据，又解决了MBR对大容量磁盘的限制问题。</p><h2 id="参考命令" tabindex="-1"><a class="header-anchor" href="#参考命令"><span>参考命令</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">parted</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/vdb</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">        # 磁盘分区工具</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mkfs.xfs</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">              # 创建XFS文件系统</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">pvcreate</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">              # 创建物理卷</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vgextend</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">              # 扩展卷组</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lvextend</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">              # 扩展逻辑卷</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">xfs_growfs</span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">            # XFS文件系统扩容</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>',27)],l={},t=(0,a(2789).A)(l,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,e)}]]),h=JSON.parse('{"path":"/posts/2024-10-31-blog_linuxdisk.html","title":"Linux LVM磁盘在线扩容教程","lang":"zh-CN","frontmatter":{"title":"Linux LVM磁盘在线扩容教程","category":["Linux","LVM"],"tag":["LVM","parted"],"sticky":true,"star":false,"order":-1,"description":"Linux LVM磁盘在线扩容教程 问题背景 在虚拟机环境下，需要将一个2TB的磁盘扩容到2.5TB。初始磁盘使用MBR分区表，由于MBR不支持2TB以上的分区，需要特殊处理。 系统环境 操作系统：Linux 原始磁盘：2TB (/dev/vdb) 目标容量：2.5TB 文件系统：XFS 分区方式：从MBR转换到GPT 问题分析 MBR分区表限制：最大...","head":[["meta",{"property":"og:url","content":"https://newzone.top/posts/2024-10-31-blog_linuxdisk.html"}],["meta",{"property":"og:site_name","content":"LearnData 开源笔记"}],["meta",{"property":"og:title","content":"Linux LVM磁盘在线扩容教程"}],["meta",{"property":"og:description","content":"Linux LVM磁盘在线扩容教程 问题背景 在虚拟机环境下，需要将一个2TB的磁盘扩容到2.5TB。初始磁盘使用MBR分区表，由于MBR不支持2TB以上的分区，需要特殊处理。 系统环境 操作系统：Linux 原始磁盘：2TB (/dev/vdb) 目标容量：2.5TB 文件系统：XFS 分区方式：从MBR转换到GPT 问题分析 MBR分区表限制：最大..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-04T03:42:20.000Z"}],["meta",{"property":"article:author","content":"LearnData"}],["meta",{"property":"article:tag","content":"LVM"}],["meta",{"property":"article:tag","content":"parted"}],["meta",{"property":"article:modified_time","content":"2024-11-04T03:42:20.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Linux LVM磁盘在线扩容教程\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-04T03:42:20.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LearnData\\",\\"url\\":\\"https://newzone.top\\"}]}"]]},"headers":[{"level":2,"title":"问题背景","slug":"问题背景","link":"#问题背景","children":[]},{"level":2,"title":"系统环境","slug":"系统环境","link":"#系统环境","children":[]},{"level":2,"title":"问题分析","slug":"问题分析","link":"#问题分析","children":[]},{"level":2,"title":"解决步骤","slug":"解决步骤","link":"#解决步骤","children":[{"level":3,"title":"1. 使用parted工具进行分区","slug":"_1-使用parted工具进行分区","link":"#_1-使用parted工具进行分区","children":[]},{"level":3,"title":"2. 格式化新分区并加入LVM","slug":"_2-格式化新分区并加入lvm","link":"#_2-格式化新分区并加入lvm","children":[]}]},{"level":2,"title":"LVM清理步骤","slug":"lvm清理步骤","link":"#lvm清理步骤","children":[{"level":3,"title":"1. 清理逻辑卷（LV）","slug":"_1-清理逻辑卷-lv","link":"#_1-清理逻辑卷-lv","children":[]},{"level":3,"title":"2. 清理卷组（VG）","slug":"_2-清理卷组-vg","link":"#_2-清理卷组-vg","children":[]},{"level":3,"title":"3. 清理物理卷（PV）","slug":"_3-清理物理卷-pv","link":"#_3-清理物理卷-pv","children":[]},{"level":3,"title":"注意事项","slug":"注意事项","link":"#注意事项","children":[]}]},{"level":2,"title":"注意事项","slug":"注意事项-1","link":"#注意事项-1","children":[]},{"level":2,"title":"总结","slug":"总结","link":"#总结","children":[]},{"level":2,"title":"参考命令","slug":"参考命令","link":"#参考命令","children":[]}],"git":{"createdTime":1730691740000,"updatedTime":1730691740000,"contributors":[{"name":"lengxc","email":"lengxc@qiysd.com","commits":1}]},"readingTime":{"minutes":2.41,"words":723},"filePathRelative":"_posts/2024-10-31-blog_linuxdisk.md","localizedDate":"2024年11月4日","excerpt":"\\n<h2>问题背景</h2>\\n<p>在虚拟机环境下，需要将一个2TB的磁盘扩容到2.5TB。初始磁盘使用MBR分区表，由于MBR不支持2TB以上的分区，需要特殊处理。</p>\\n<h2>系统环境</h2>\\n<ul>\\n<li>操作系统：Linux</li>\\n<li>原始磁盘：2TB (/dev/vdb)</li>\\n<li>目标容量：2.5TB</li>\\n<li>文件系统：XFS</li>\\n<li>分区方式：从MBR转换到GPT</li>\\n</ul>\\n<h2>问题分析</h2>\\n<ol>\\n<li>MBR分区表限制：最大支持2TB空间</li>\\n<li>需要保留原有LVM数据</li>\\n<li>新增空间需要创建新分区并加入现有卷组</li>\\n</ol>","autoDesc":true}')}}]);