"use strict";(self.webpackChunklearn_data=self.webpackChunklearn_data||[]).push([[4220],{2789:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,n]of s)a[i]=n;return a}},7686:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>l,data:()=>h});var n=a(7829);const e=[(0,n.Fv)('<h3 id="mongodb-崩溃分析与修复指南" tabindex="-1"><a class="header-anchor" href="#mongodb-崩溃分析与修复指南"><span>MongoDB 崩溃分析与修复指南</span></a></h3><p>在运行 MongoDB 时，有时会遇到崩溃问题，导致数据库服务不可用。最近在一次服务器运行过程中，MongoDB 由于异常导致崩溃。本文将分析该崩溃日志并提供相应的修复步骤，帮助你快速解决类似问题。</p><h4 id="崩溃日志分析" tabindex="-1"><a class="header-anchor" href="#崩溃日志分析"><span>崩溃日志分析</span></a></h4><p>根据 MongoDB 提供的日志，崩溃时的关键信息如下：</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;t&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;$date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;2024-10-25T03:13:56.340+08:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">},</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;F&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;CONTROL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4757800</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;ctx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ftdc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;msg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Writing fatal message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;attr&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;terminate() called. An exception is active; attempting to gather more information&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;t&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">&quot;$date&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;2024-10-25T03:13:56.454+08:00&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">},</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;s&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;F&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;c&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;CONTROL&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4757800</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;ctx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ftdc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;msg&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;Writing fatal message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">  &quot;attr&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: {</span></span>\n<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#E06C75;">    &quot;message&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;DBException::toString(): FileStreamFailed: Failed to write to interim file buffer for full-time diagnostic data capture: /mnt/data/qysd/mongo/diagnostic.data/metrics.interim.temp</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Actual exception type: mongo::error_details::ExceptionForImpl&lt;(mongo::ErrorCodes::Error)39, mongo::AssertionException&gt;&quot;</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  }</span></span>\n<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从日志中，我们可以提取出以下几点关键信息：</p><ul><li><strong>崩溃原因</strong>：MongoDB 在执行 <code>terminate()</code> 之前，试图写入诊断数据临时文件时失败。报错的具体路径是 <code>/mnt/data/qysd/mongo/diagnostic.data/metrics.interim.temp</code>，错误代码为 <code>ErrorCodes::Error 39</code>。</li><li><strong>异常描述</strong>：异常类型为 <code>FileStreamFailed</code>，表明 MongoDB 无法写入该临时文件，可能是由于磁盘问题、权限不足或磁盘空间不足等原因。</li><li><strong>回溯信息</strong>：日志显示了详细的回溯（Backtrace），这有助于开发人员追踪崩溃的具体调用路径。</li></ul><h4 id="磁盘空间检查" tabindex="-1"><a class="header-anchor" href="#磁盘空间检查"><span>磁盘空间检查</span></a></h4><p>使用 <code>df -h</code> 命令检查磁盘空间状况：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Filesystem</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      Size</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  Used</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Avail</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Use%</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Mounted</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> on</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">/dev/nvme0n1p1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  100G</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   73G</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   25G</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  73%</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /mnt/data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>从输出结果可以看到，<code>/mnt/data</code> 仍有 25 GB 可用空间，磁盘空间似乎充足，但并不能排除文件系统配额限制或特定目录权限问题。</p><h4 id="可能的崩溃原因" tabindex="-1"><a class="header-anchor" href="#可能的崩溃原因"><span>可能的崩溃原因</span></a></h4><ol><li><p><strong>文件系统权限不足</strong>：</p><ul><li>MongoDB 可能对 <code>/mnt/data/qysd/mongo/diagnostic.data/</code> 目录没有足够的写权限。</li></ul></li><li><p><strong>文件系统配额或限制</strong>：</p><ul><li>尽管磁盘空间充足，仍可能由于文件系统的配额或限制，导致 MongoDB 无法写入。</li></ul></li><li><p><strong>磁盘 I/O 错误或文件系统损坏</strong>：</p><ul><li>磁盘可能存在损坏，或文件系统出现错误，导致 MongoDB 写入失败。</li></ul></li></ol><h4 id="修复步骤" tabindex="-1"><a class="header-anchor" href="#修复步骤"><span>修复步骤</span></a></h4><p>根据上述分析，提出了以下修复建议：</p><ol><li><p><strong>检查磁盘健康状态</strong></p><ul><li><p>使用 <code>dmesg</code> 命令查看是否有 I/O 错误或磁盘相关问题：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dmesg</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -i</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;I/O error&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>运行 <code>fsck</code> 命令对相关分区进行文件系统检查：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> fsck</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /dev/nvme0n1p1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>检查文件系统权限</strong></p><ul><li><p>验证 MongoDB 对 <code>/mnt/data/qysd/mongo/diagnostic.data/</code> 目录是否具有写权限：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ls</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -ld</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /mnt/data/qysd/mongo/diagnostic.data/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>如果权限不足，可以通过 <code>chmod</code> 或 <code>chown</code> 命令修正权限：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 755</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /mnt/data/qysd/mongo/diagnostic.data/</span></span>\n<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mongodb:mongodb</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /mnt/data/qysd/mongo/diagnostic.data/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ul></li><li><p><strong>检查磁盘配额</strong></p><ul><li><p>查看是否启用了磁盘配额，限制了 MongoDB 的写入操作：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> repquota</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /mnt/data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li><li><p><strong>重启 MongoDB</strong></p><ul><li><p>在解决了磁盘或权限问题后，可以尝试重启 MongoDB 并查看其运行状态：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mongod</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>查看重启后的日志，确保没有再次出现同样的问题：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /var/log/mongodb/mongod.log</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul></li></ol><h4 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h4><p>MongoDB 崩溃的常见原因包括文件系统权限问题、磁盘空间不足或 I/O 错误等。在这次崩溃事件中，通过分析日志，我们发现 MongoDB 在尝试写入诊断数据时失败，原因可能是文件系统或磁盘问题。通过检查磁盘状态、修复权限问题并重启服务，可以有效解决此类问题。</p><h4 id="参考命令" tabindex="-1"><a class="header-anchor" href="#参考命令"><span>参考命令</span></a></h4><ul><li>检查磁盘状态：<code>dmesg</code></li><li>文件系统检查：<code>fsck</code></li><li>检查权限：<code>ls -ld</code></li><li>修改权限：<code>chmod</code>、<code>chown</code></li><li>检查磁盘配额：<code>repquota</code></li><li>重启 MongoDB：<code>systemctl restart mongod</code></li></ul><hr>',21)],t={},l=(0,a(2789).A)(t,[["render",function(i,s){return(0,n.uX)(),(0,n.CE)("div",null,e)}]]),h=JSON.parse('{"path":"/posts/2024-10-25-blog_mongodb.html","title":"MongoDB 崩溃分析与修复指南","lang":"zh-CN","frontmatter":{"title":"MongoDB 崩溃分析与修复指南","category":["MongoDB"],"tag":["服务宕机"],"sticky":false,"star":false,"order":-0.01,"description":"MongoDB 崩溃分析与修复指南 在运行 MongoDB 时，有时会遇到崩溃问题，导致数据库服务不可用。最近在一次服务器运行过程中，MongoDB 由于异常导致崩溃。本文将分析该崩溃日志并提供相应的修复步骤，帮助你快速解决类似问题。 崩溃日志分析 根据 MongoDB 提供的日志，崩溃时的关键信息如下： 从日志中，我们可以提取出以下几点关键信息： 崩...","head":[["meta",{"property":"og:url","content":"https://newzone.top/posts/2024-10-25-blog_mongodb.html"}],["meta",{"property":"og:site_name","content":"LearnData 开源笔记"}],["meta",{"property":"og:title","content":"MongoDB 崩溃分析与修复指南"}],["meta",{"property":"og:description","content":"MongoDB 崩溃分析与修复指南 在运行 MongoDB 时，有时会遇到崩溃问题，导致数据库服务不可用。最近在一次服务器运行过程中，MongoDB 由于异常导致崩溃。本文将分析该崩溃日志并提供相应的修复步骤，帮助你快速解决类似问题。 崩溃日志分析 根据 MongoDB 提供的日志，崩溃时的关键信息如下： 从日志中，我们可以提取出以下几点关键信息： 崩..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-11-02T12:20:13.000Z"}],["meta",{"property":"article:author","content":"LearnData"}],["meta",{"property":"article:tag","content":"服务宕机"}],["meta",{"property":"article:modified_time","content":"2024-11-02T12:20:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MongoDB 崩溃分析与修复指南\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-11-02T12:20:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"LearnData\\",\\"url\\":\\"https://newzone.top\\"}]}"]]},"headers":[{"level":3,"title":"MongoDB 崩溃分析与修复指南","slug":"mongodb-崩溃分析与修复指南","link":"#mongodb-崩溃分析与修复指南","children":[]}],"git":{"createdTime":1729824913000,"updatedTime":1730550013000,"contributors":[{"name":"lengxc","email":"lengxc@qiysd.com","commits":1},{"name":"lengxiangcong","email":"43166924+luoqiuc@users.noreply.github.com","commits":1},{"name":"luoqiuc","email":"960352683@qq.com","commits":1}]},"readingTime":{"minutes":3.53,"words":1059},"filePathRelative":"_posts/2024-10-25-blog_mongodb.md","localizedDate":"2024年10月25日","excerpt":"<h3>MongoDB 崩溃分析与修复指南</h3>\\n<p>在运行 MongoDB 时，有时会遇到崩溃问题，导致数据库服务不可用。最近在一次服务器运行过程中，MongoDB 由于异常导致崩溃。本文将分析该崩溃日志并提供相应的修复步骤，帮助你快速解决类似问题。</p>\\n<h4>崩溃日志分析</h4>\\n<p>根据 MongoDB 提供的日志，崩溃时的关键信息如下：</p>\\n<div class=\\"language-json line-numbers-mode\\" data-highlighter=\\"shiki\\" data-ext=\\"json\\" data-title=\\"json\\" style=\\"--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">{</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"t\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: {</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">\\"$date\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"2024-10-25T03:13:56.340+08:00\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">},</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"s\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"F\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"c\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"CONTROL\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"id\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\">4757800</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"ctx\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"ftdc\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"msg\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"Writing fatal message\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"attr\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">    \\"message\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"terminate() called. An exception is active; attempting to gather more information\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">  }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">}</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">{</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"t\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: {</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">\\"$date\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"2024-10-25T03:13:56.454+08:00\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">},</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"s\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"F\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"c\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"CONTROL\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"id\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#D19A66\\">4757800</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"ctx\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"ftdc\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"msg\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"Writing fatal message\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">,</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">  \\"attr\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#005CC5;--shiki-dark:#E06C75\\">    \\"message\\"</span><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">: </span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">\\"DBException::toString(): FileStreamFailed: Failed to write to interim file buffer for full-time diagnostic data capture: /mnt/data/qysd/mongo/diagnostic.data/metrics.interim.temp</span><span style=\\"--shiki-light:#005CC5;--shiki-dark:#56B6C2\\">\\\\n</span><span style=\\"--shiki-light:#032F62;--shiki-dark:#98C379\\">Actual exception type: mongo::error_details::ExceptionForImpl&lt;(mongo::ErrorCodes::Error)39, mongo::AssertionException&gt;\\"</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">  }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#24292E;--shiki-dark:#ABB2BF\\">}</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\" style=\\"counter-reset:line-number 0\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}')}}]);